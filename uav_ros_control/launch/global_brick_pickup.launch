<launch>
  <arg name="namespace"   default="$(env UAV_NAMESPACE)"/>
  <arg name="odom"        default="mavros/global_position/local"/>
  
  <!-- Local Visual Servo stack -->
  <include file="$(find uav_ros_control)/launch/visual_servo_brick.launch">
    <arg name="namespace" value="$(arg namespace)"/>
    <arg name="odom" value="$(arg odom)"/>
  </include>

  <!-- Start generic trajectory generator -->
  <include file="$(find topp_ros)/launch/generic_trajectory.launch">
    <arg name="odom" value="$(arg odom)"/>  
  </include>

  <!-- Global Visual Servo stack -->
  <group ns="$(arg namespace)">

    <!-- Load Global Pickup state machine parameters -->
    <rosparam command="load" file="$(find uav_ros_control)/config/reference/global_pickup_sm.yaml" />

    <!-- Start global pickup state machine -->
    <node pkg="uav_ros_control" type="brick_pickup_sm" name="global_pickup_sm" output="screen">
      <remap from="odometry" to="$(arg odom)"/>
    </node>
  
  </group>

  <!-- Magnet overrride service -->
  <include file="$(find multirotor_transformations)/launch/rc_override.launch"/>

  <!-- Start magnet activity topic TODO: Check topics inside this launch file! -->
  <include file="$(find brick_detector)/launch/brick_detector.launch"/>

</launch>